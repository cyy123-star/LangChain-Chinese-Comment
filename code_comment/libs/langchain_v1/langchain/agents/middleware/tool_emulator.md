# Tool Emulator Middleware (工具仿真中间件)

`tool_emulator.py` 实现了 `LLMToolEmulator`，它允许在测试或开发阶段，使用一个辅助 LLM 来模拟真实工具的输出，而不需要实际执行工具代码。

## 核心功能 (Core Features)

1.  **工具模拟**: 拦截工具调用，改由 LLM 根据工具描述和参数生成模拟结果。
2.  **选择性模拟**: 支持配置仅模拟部分工具，或模拟全部工具。
3.  **高保真度**: 模拟 LLM 会参考真实的工具 `description` 来生成符合预期的响应。
4.  **开发加速**: 在真实工具（如耗时长的 API、有副作用的操作）尚未就绪或不便执行时，可以快速进行端到端测试。

## 类定义与参数 (Class Definition & Parameters)

### `LLMToolEmulator`

| 参数 | 类型 | 默认值 | 说明 |
| :--- | :--- | :--- | :--- |
| `tools` | `list[str \| BaseTool] \| None` | `None` | 要模拟的工具列表。`None` 表示模拟所有工具。 |
| `model` | `str \| BaseChatModel \| None` | Claude 4.5 | 用于生成模拟响应的模型。 |

## 执行逻辑 (Execution Logic)

1.  **工具匹配 (`wrap_tool_call`)**:
    - 获取当前调用的工具名称。
    - 判断是否需要模拟。
2.  **构造提示词**:
    - 如果需要模拟，构造一个包含工具名、描述和传入参数的 Prompt。
    - 要求模型“仅返回工具的输出内容，不包含解释”。
3.  **短路返回**:
    - 调用模拟模型获取响应。
    - 封装为 `ToolMessage` 并直接返回给代理，**跳过真实工具的 `handler` 调用**。

## 使用场景 (Usage Scenarios)

- **CI/CD 测试**: 在没有真实环境的情况下测试代理逻辑。
- **UI 原型开发**: 快速演示代理与复杂工具的交互。
- **异常模拟**: 引导模拟模型生成特定的错误信息，测试代理的容错能力。

## 注意事项 (Notes)

- **非真实结果**: 模拟结果可能与真实执行存在细微差别，特别是格式敏感的场景。
- **Token 消耗**: 每次模拟都会产生额外的 LLM 调用开销。

